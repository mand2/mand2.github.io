<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.92.1" />
    <meta name="description" content="goranee&#39;s dev-log">
<meta name="author" content="mand2">

    <link rel="shortcut icon" href="https://image.flaticon.com/icons/svg/2950/2950487.svg" type="image/x-icon" />
    <title>[세미나] 202203 우아한테크세미나-분산 이벤트 스트리밍 정리(feat.카프카 스트림즈) :: 고라니의 개발일기🦌</title>

    
    <link href="/css/nucleus.css?1651153135" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1651153135" rel="stylesheet">
    <link href="/css/hybrid.css?1651153135" rel="stylesheet">
    <link href="/css/featherlight.min.css?1651153135" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1651153135" rel="stylesheet">
    <link href="/css/auto-complete.css?1651153135" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1651153135" rel="stylesheet">
    <link href="/css/theme.css?1651153135" rel="stylesheet">
    <link href="/css/hugo-theme.css?1651153135" rel="stylesheet">
    
    <link href="/css/theme-mine.css?1651153135" rel="stylesheet">
    
    <link href="/css/custom.css?1651153135" rel="stylesheet">

    <script src="/js/jquery-3.3.1.min.js?1651153135"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-145937348-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
    
  </head>
  <body class="" data-url="/others/202203-woowahan-tech-seminar/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://mand2.github.io/">
고라니의 개발일기🦌
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1651153135"></script>
<script type="text/javascript" src="/js/auto-complete.js?1651153135"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/mand2.github.io\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1651153135"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/about/" title="About" class="dd-item 
        
        
        
        ">
      <a href="/about/">
          <b>0. </b>About
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/about/portfolio/" title="Portfolio" class="dd-item ">
        <a href="/about/portfolio/">
        Portfolio
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/spring/" title="Spring" class="dd-item 
        
        
        
        ">
      <a href="/spring/">
          <b>1. </b>Spring
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/spring/rest-api/" title="Rest Api" class="dd-item 
        
        
        
        ">
      <a href="/spring/rest-api/">
          Rest Api
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
             
            
          
             
            
          
             
            
          
             
            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/spring/spring-boot/" title="Spring Boot" class="dd-item 
        
        
        
        ">
      <a href="/spring/spring-boot/">
          Spring Boot
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
             
            
          
             
            
          
             
            
          
             
            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/spring/user_register/" title="회원가입" class="dd-item 
        
        
        
        ">
      <a href="/spring/user_register/">
          회원가입
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/til/" title="TIL" class="dd-item 
        
        
        
        ">
      <a href="/til/">
          <b>2. </b>TIL
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/til/aws_s3_%EB%A1%9C%EC%BB%AC%EB%94%94%EB%A0%89%ED%86%A0%EB%A6%AC_%EC%97%85%EB%A1%9C%EB%93%9C%ED%95%98%EA%B8%B0/" title="[AWS S3] 로컬 디렉토리에 있는 모든 파일 S3로 업로드하기" class="dd-item ">
        <a href="/til/aws_s3_%EB%A1%9C%EC%BB%AC%EB%94%94%EB%A0%89%ED%86%A0%EB%A6%AC_%EC%97%85%EB%A1%9C%EB%93%9C%ED%95%98%EA%B8%B0/">
        [AWS S3] 로컬 디렉토리에 있는 모든 파일 S3로 업로드하기
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/til/%EC%95%84%EB%82%98%EC%BD%98%EB%8B%A4_%EC%A3%BC%ED%94%BC%ED%84%B0_%EB%85%B8%ED%8A%B8%EB%B6%81_%EC%8B%9C%EC%9E%91%ED%8F%B4%EB%8D%94_%EC%9C%84%EC%B9%98_%EB%B0%94%EA%BE%B8%EA%B8%B0/" title="아나콘다 주피터 노트북 시작폴더 위치 바꾸기" class="dd-item ">
        <a href="/til/%EC%95%84%EB%82%98%EC%BD%98%EB%8B%A4_%EC%A3%BC%ED%94%BC%ED%84%B0_%EB%85%B8%ED%8A%B8%EB%B6%81_%EC%8B%9C%EC%9E%91%ED%8F%B4%EB%8D%94_%EC%9C%84%EC%B9%98_%EB%B0%94%EA%BE%B8%EA%B8%B0/">
        아나콘다 주피터 노트북 시작폴더 위치 바꾸기
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/til/send-messages-to-sqs-by-java/" title="Java 형식으로 AWS SQS에 메세지 보내기" class="dd-item ">
        <a href="/til/send-messages-to-sqs-by-java/">
        Java 형식으로 AWS SQS에 메세지 보내기
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/til/show-git-contribute-in-3d/" title="Git 커밋 그래프(contribution graph)를 3D로 보는 방법" class="dd-item ">
        <a href="/til/show-git-contribute-in-3d/">
        Git 커밋 그래프(contribution graph)를 3D로 보는 방법
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/til/java-str-to-double/" title="자바 형변환 안전하게 하기" class="dd-item ">
        <a href="/til/java-str-to-double/">
        자바 형변환 안전하게 하기
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/til/get-autoscaling-by-js/" title="자바스크립트로 AWS autoscaling group 정보 가져오기" class="dd-item ">
        <a href="/til/get-autoscaling-by-js/">
        자바스크립트로 AWS autoscaling group 정보 가져오기
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/til/blog-auto-commit/" title="블로그 커밋 메세지 만들고 자동 배포 하기" class="dd-item ">
        <a href="/til/blog-auto-commit/">
        블로그 커밋 메세지 만들고 자동 배포 하기
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/til/build-plugs-of-maven/" title="Maven pom.xml 빌드 플러그인 세팅하기" class="dd-item ">
        <a href="/til/build-plugs-of-maven/">
        Maven pom.xml 빌드 플러그인 세팅하기
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/til/definition-db-index/" title="DB index의 정의" class="dd-item ">
        <a href="/til/definition-db-index/">
        DB index의 정의
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/til/collection-framework/" title="컬렉션 프레임워크의 정의와 stream 사용법 간단 정리" class="dd-item ">
        <a href="/til/collection-framework/">
        컬렉션 프레임워크의 정의와 stream 사용법 간단 정리
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/python/" title="Python" class="dd-item 
        
        
        
        ">
      <a href="/python/">
          <b>3. </b>Python
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/python/1/" title="getter setter 설정" class="dd-item ">
        <a href="/python/1/">
        getter setter 설정
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/python/2/" title="윈도우에서 Ubuntu로 pycharm 설치할 수 있을까" class="dd-item ">
        <a href="/python/2/">
        윈도우에서 Ubuntu로 pycharm 설치할 수 있을까
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/node.js/" title="Node.js" class="dd-item 
        
        
        
        ">
      <a href="/node.js/">
          <b>4. </b>Node.js
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/node.js/1/" title="package-lock.json 이란?" class="dd-item ">
        <a href="/node.js/1/">
        package-lock.json 이란?
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/node.js/2/" title="formidable 설치 오류 해결하기" class="dd-item ">
        <a href="/node.js/2/">
        formidable 설치 오류 해결하기
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/node.js/3/" title="aws EC2로 node.js 배포하기" class="dd-item ">
        <a href="/node.js/3/">
        aws EC2로 node.js 배포하기
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/react/" title="React" class="dd-item 
        
        
        
        ">
      <a href="/react/">
          <b>5. </b>React
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/react/1/" title="데이터 테이블로 정렬하기" class="dd-item ">
        <a href="/react/1/">
        데이터 테이블로 정렬하기
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/react/2/" title="테이블을 엑셀로 다운로드" class="dd-item ">
        <a href="/react/2/">
        테이블을 엑셀로 다운로드
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/react/3/" title="javascript의 innerHTML과 같은 기능은?" class="dd-item ">
        <a href="/react/3/">
        javascript의 innerHTML과 같은 기능은?
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/others/" title="Others" class="dd-item 
        parent
        
        
        ">
      <a href="/others/">
          <b>99. </b>Others
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/others/202204-woowahan-tech-seminar/" title="[세미나] 202204 우아한테크세미나-지속가능한 SW 개발을 위한 코드리뷰" class="dd-item ">
        <a href="/others/202204-woowahan-tech-seminar/">
        [세미나] 202204 우아한테크세미나-지속가능한 SW 개발을 위한 코드리뷰
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/others/202203-woowahan-tech-seminar/" title="[세미나] 202203 우아한테크세미나-분산 이벤트 스트리밍 정리(feat.카프카 스트림즈)" class="dd-item active">
        <a href="/others/202203-woowahan-tech-seminar/">
        [세미나] 202203 우아한테크세미나-분산 이벤트 스트리밍 정리(feat.카프카 스트림즈)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/others/activity-gdg-devfest-2020/" title="[활동] Devfest Korea 2020 10.16~" class="dd-item ">
        <a href="/others/activity-gdg-devfest-2020/">
        [활동] Devfest Korea 2020 10.16~
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/others/start-hugo-1/" title="Hugo로 블로그 만들기 1" class="dd-item ">
        <a href="/others/start-hugo-1/">
        Hugo로 블로그 만들기 1
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/others/books/" title="Books" class="dd-item 
        
        
        
        ">
      <a href="/others/books/">
          Books
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/others/books/2021%EB%85%84_%EC%96%B4%EB%96%A4_%EC%B1%85%EC%9D%84_%EC%9D%BD%EC%97%88%EA%B3%A0_%EC%9D%BD%EA%B3%A0%EC%9E%88%EB%82%98/" title="[책] 2021년 어떤 책을 읽었고 읽고 있나" class="dd-item ">
        <a href="/others/books/2021%EB%85%84_%EC%96%B4%EB%96%A4_%EC%B1%85%EC%9D%84_%EC%9D%BD%EC%97%88%EA%B3%A0_%EC%9D%BD%EA%B3%A0%EC%9E%88%EB%82%98/">
        [책] 2021년 어떤 책을 읽었고 읽고 있나
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/others/books/objects_1/" title="[책] 오브젝트 (1)" class="dd-item ">
        <a href="/others/books/objects_1/">
        [책] 오브젝트 (1)
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/others/interviews/" title="면접질문 정리" class="dd-item ">
        <a href="/others/interviews/">
        면접질문 정리
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/retro/" title="회고" class="dd-item 
        
        
        
        ">
      <a href="/retro/">
          <b>X. </b>회고
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://github.com/mand2"><i class='fab fa-github'></i> Github repo</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://mand2.github.io/categories"><i class='fas fa-bookmark'></i> Categories</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://mand2.github.io/tags"><i class='fas fa-tags'></i> Tags</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>
<p>favicon by <a href="http://www.freepik.com/" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/kr/" title="Flaticon">www.flaticon.com</a></p>
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>고라니의 개발일기🦌</a> > <a href='/others/'>Others</a> > [세미나] 202203 우아한테크세미나-분산 이벤트 스트리밍 정리(feat.카프카 스트림즈)
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ol>
    <li>
      <ol>
        <li><a href="#1-주문에-대한-트래킹-처리-방식">1. 주문에 대한 트래킹 처리 방식</a></li>
        <li><a href="#2-카프카를-사용해보자-문제-해결-2">2. 카프카를 사용해보자! 문제 해결? (2)</a></li>
        <li><a href="#3-데이터-유실-방지-전략">3. 데이터 유실 방지 전략</a></li>
        <li><a href="#4-카프카-스트림즈">4. 카프카 스트림즈</a></li>
        <li><a href="#5-할당--uber-h3-사용">5. 할당- Uber H3 사용</a></li>
        <li><a href="#6-qa">6. Q&amp;A</a></li>
      </ol>
    </li>
  </ol>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
<div class="tags">

  <a class="tag-link" href="/tags/session">Session</a>

  <a class="tag-link" href="/tags/activity">Activity</a>

  <a class="tag-link" href="/tags/others">Others</a>

</div>

        </div>
        
        <div id="body-inner">
          
            <h1>
              
              [세미나] 202203 우아한테크세미나-분산 이벤트 스트리밍 정리(feat.카프카 스트림즈)
            </h1>
          

        

<span class="btn_tags">
    2022-04-01
</span>

<p>이번달 우아한 테크 세미나 주제는 분산 이벤트 스트리밍! 유튜브에 올라온 걸 들으면서(일이 있어서 실시간으로 듣진 못함 🥲) 빠르게 간단 정리해 보았다.<br>
최근에 메세징 큐 방식으로 서비스 처리하는 업무를 했어서 그런지 조금 더 이해하기 수월했다(<del>평소엔 이해하기 어려운 토픽이 많았&hellip;</del>)
덕분에 좀 더 깊게 분산 이벤트 스트리밍을 배울 수 있었다. 카프카를 써서 대용량 처리를 해보고 싶기도..ㅎㅎ</p>
<br>
<hr>
<p>도입 이유는 아래에 더 길게 쓸 테지만 짧게 요약하자면</p>
<ul>
<li>데이터처리: 실제 처리량이 많아지다 보니까 시스템화(자동화)해서 해서 만들 필요가 있었음.</li>
<li>실제 수치를 알아야 한다. 이 지역에 대한 배달 인프라 지표 산출하는 방법을 어떻게 처리할 지 고민이 필요했음.</li>
</ul>
<br>
<h3 id="1-주문에-대한-트래킹-처리-방식">1. 주문에 대한 트래킹 처리 방식</h3>
<h4 id="11-통계-수치-뽑기-기본">1.1. 통계 수치 뽑기 (기본)</h4>
<ul>
<li>
<p>주문하고 특정 시간이상 인 주문건에 대한 처리</p>
<p>처리 방법: 스케쥴러 → RDS</p>
<p>스케쥴러 돌리는 방법 다양함. (쿼리 돌리기)</p>
<ul>
<li>스프림프레임웍 : batch ? (잘 안들렸음)</li>
<li>젠킨스 시간마다 job 돌리기</li>
<li>unix/linux crontab</li>
</ul>
</li>
<li>
<p>주문을 배달원에게 배차 : 쿼리를 정기적으로 실행</p>
<ul>
<li>
<p>주문 목록(처리가능한) + 라이더 목록(배차가능한) 쿼리 각각.</p>
</li>
<li>
<p>지역+상태별 실시간 수 지표</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> <span style="color:#960050;background-color:#1e0010">지역</span>,<span style="color:#960050;background-color:#1e0010">상태</span>, <span style="color:#66d9ef">count</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">주문</span> <span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> <span style="color:#960050;background-color:#1e0010">지역</span>, <span style="color:#960050;background-color:#1e0010">상태</span>
</code></pre></div></li>
</ul>
</li>
</ul>
<h4 id="12-문제-서버-한대가-모든-로직-수행한다">1.2. 문제: 서버 한대가 모든 로직 수행한다</h4>
<p>지표를 1분만에 뽑아야 하는데 수천건에 대한 처리는 어려움. (서비스가 커짐에 따라)
실제 배차 산출하는 기간 15초.. 등등 매우 짧다. 1분은 예시일 뿐.</p>
<p>문제 해결 방법 list:</p>
<ul>
<li>멀티쓰레드 형식으로 처리하거나..</li>
<li>서버마다 VM을 따로 띄워서(지역별 파티션 나눠서) 처리</li>
<li>지역별 서버 따로 띄우기 ⇒ 관리의 허들이 있음. capa 관리 복잡.</li>
</ul>
<h4 id="13-문제-해결-1">1.3. 문제 해결? (1)</h4>
<p>AWS SQS 를 사용해서 지역별 파티션 키가 있다고 가정, 큐로 처리.</p>
<p>예를 들어, 모든 지역의 파티션 키가 1~100 이라고 하면</p>
<ul>
<li>Command Sender (지역 파티션 키와 함께 해당 정보를 큐로 보냄) - 명령을 보내는 배치서버. 이벤트를 보냄.</li>
<li>Queue (파티션 키에 맞는 command Receiver 찾고 해당 리시버에 큐를 보냄) - like AWS SQS.
사실 한대로 처리함. 문제가 생기면 2대로 할 수 있긴 하지만 이건 처리 이슈가 발생할 수 있음. 어디로 분배되는지 트래킹이 어려울 수도?</li>
<li>Command Receiver (해당 정보를 실제로 처리) - 마치 워커 쓰레드가 분산처리하듯.
Spring boot 에서는  sqs listener 처리가 잘 되어있어서 좋음..ㅎㅎ</li>
</ul>
<p>문제</p>
<ol>
<li>
<p>메세지 중복처리 문제 : SQS가 중복처리 되었는지 안되었는지 개발자가 처리해야 된다.<br>
→ 이따 뒤에서 설명. 파티션은 쏠림현상이 있을 수밖에 없다. 서울..!! 서울/경기: 전체 트래픽의 90%.<br>
SQS FIFO 안씀. ‘굳이 써야할 필요가 있나?’ 싶다고 함. (비싸기도 하고..)
우발적인 상황에 대처하는 어플리케이션을 만드는 게 낫다.</p>
</li>
<li>
<p><strong>Command Server (Batch server) 이중화 불가.</strong> 분산처리가 안된다.
서버가 죽을 수 있기 때문에 최소 3(매직넘버)을 동시 운용하진 못하지만, active-standby 설정함.</p>
<p>global lock을 선언해 둠(redis , rds) - 문제가 되었을 때 복구화할 수 있도록 함.</p>
</li>
<li>
<p>쿼리 리시버에서 지속적인 RDS fetch <br>
모든 RDS remote에 값을 갱신처리해야 트래킹이 가능하기 때문 ㅠ<br>
→ latency 문제 + RDS 매우 비쌈. reader 여러개 꽂았다고 하더라도 돈이..! (근본적인 문제점)</p>
</li>
</ol>
<br>
<hr>
<h3 id="2-카프카를-사용해보자-문제-해결-2">2. 카프카를 사용해보자! 문제 해결? (2)</h3>
<h4 id="2-0-서적-추천">2-0. 서적 추천</h4>
<p>Apache Kafka 관련 서적 : MANNING에서 나온 책.  Kafka Streams IN ACTION.</p>
<p>생각보다는 쉽다고 하시는데 음..!</p>
<h4 id="2-1-카프카-장점">2-1 카프카 장점</h4>
<ul>
<li>high-performance data pipeline :
네트웍을 타는 순간 latency가 발생함. 메모리에 있는게 가장 빠르니까.</li>
<li>streaming analysis</li>
<li>data integration</li>
<li>mission-critical : 미션을 완료하기에 도움이 될 수 있다~ 장애대응이 더 유용할 수 있다~ (이걸 하기 위해 너가 잘 만들어야한다~ 라고 이해하는게 좋다고 하심 ㅎㅎ)</li>
</ul>
<h4 id="2-2-카프카-기본">2-2. 카프카 기본.</h4>
<p>Broker(중개인) , Producer, Consumer,</p>
<ul>
<li>
<p>브로커 : <code>카프카</code> 를 지칭.</p>
</li>
<li>
<p>The log = event streaming, event log. 토픽 주제별로 다 모여있는 것임.</p>
<ul>
<li>로그시스템: ELK, Kibana <strong>타임스탬프</strong> 기반으로 로그가 나열되어 있다. 이 로그는 토픽으로 구분되어 있다.</li>
</ul>
</li>
<li>
<p>publisher = producer</p>
</li>
<li>
<p>subscriber = consumer = receiver</p>
</li>
<li>
<p>connector = 스토리지에 있는 로그를 바로 떠서 log로 보내주거나, log를 스토리지로 넘기거나. 발표자는 커넥터는 쓰지 않는다고 함.</p>
</li>
</ul>
<hr>
<h4 id="2-3-카프카-스트림즈">2-3. 카프카 스트림즈</h4>
<p>선택 이유?</p>
<ol>
<li>개발자 자율도가 매우 높음. 거의 실시간, 준 실시간으로 빠르게 쓸 수 있어서 썼다.
개발자가 만든 서버(어플리케이션 = <code>클러스터 1개</code> 라고 함)와 연결해서 쓸 수 있음. 카프카는 운영팀에서 만들어주고, 이 카프카를 이용할 뿐이다.</li>
<li>리소스를 많이 줄임(연산 속도 확 낮아진다)</li>
</ol>
<h4 id="2-4-기존-서비스1-3-vs-kafka-를-이용한-배치서비스">2-4 기존 서비스(1-3.) vs kafka 를 이용한 배치서비스</h4>
<p>카프카: 파티션 갯수만큼 consumer 분산 할 수 있다.
group_id 에 따라 분산처리가 된다~<br>
(파티션이 없으면 컨슈머 분산할 수 없다..ㅎㅎ 분산101)</p>
<p>데이터 처리 요구조건</p>
<ul>
<li>중앙 저장소로 데이터 신속 전송 방법</li>
<li>피할 수 없는 오류로 인해 가동중지 시간이 짧고, 데이터 손실이 발생하지 않아야 함.</li>
<li>데이터 컨슈머를 확장할 수 있어야 함</li>
<li>모든 사용자가 데이터를 사용할 수 있어야 한다</li>
<li>누가 데이터를 보았는지, 보지 않았는지 추적할 필요가 없다.</li>
</ul>
<h4 id="2-5-컨슈머group_id-로-나뉘어진-처리-순서">2-5 컨슈머(group_id 로 나뉘어진) 처리 순서</h4>
<p><em>같은 파티션</em>일 때 : 타임스탬프, 즉 순서에 따라 처리가 가능하다.
즉 파티션 바깥에선 순서가 없음. 분산처리기 때문에.</p>
<p>우리 서비스는 순서가 중요해!! 하면 카프카 쓸 수 없음. 1개로만 처리해야하는데.. 왜 굳이?</p>
<hr>
<h4 id="2-6-카프카-아키텍쳐-정리1">2-6. 카프카 아키텍쳐 정리(1)</h4>
<ul>
<li>파티션 개수에 맞게 consumer(group id) 개수가 정해진다. (3개 파티션이면 컨슈머 3개~. 처리하는 서버 개수가 3개~ )
<ul>
<li>키에 의한 분할: <code>hashCode(keyBytes) % n</code></li>
</ul>
</li>
<li>카프카는 파티션을 확장할 수 있음.<br>
그러면 모듈러 연산이 바뀌고, 리밸런싱이 일어나면 → 갑자기 난리가 난다&hellip; 조심..</li>
<li>축소는 할 수 없음!</li>
<li>파티션을 커스텀 할 수 있다. 룰을 직접 만들 수 있음.</li>
<li>키를 null로 주면 round-robin으로 돌 수 있다고 함. 실제로 써본 적은 없다고 하심.</li>
</ul>
<hr>
<br>
<h3 id="3-데이터-유실-방지-전략">3. 데이터 유실 방지 전략</h3>
<h4 id="3-1-카프카-복제">3-1. 카프카 복제</h4>
<p>복제로 데이터 유실을 방어한다. 각 행위자별 행동 정리</p>
<ol>
<li>
<p>프로듀서</p>
<ul>
<li>비동기식. 콜백 call back 제공</li>
<li>속성 중, <code>acks</code> : all, 0, 1 (최소 복제 n개를 해야 성공했다는 메세지를 보내도록 세팅해야 된다)</li>
</ul>
</li>
<li>
<p>컨슈머와 파티션</p>
<ul>
<li>모든 인스턴스의 총 스레드 수 = 해당 토픽의 총 파티션 수 (이상적)</li>
<li>1 consumer = 1 partition 관리. (이상적인..)<br>
→ 받은 메세지의 오프셋을 주기적으로 커밋해야 함.<br>
<code>오프셋</code> ? 메세지를 고유하게 식별, 로그에서의 메세지 시작 위치.</li>
</ul>
</li>
<li>
<p><code>리밸런싱</code> ?</p>
<ul>
<li>발생조건: 컨슈머 개수 변경되었을 때, 파티션 개수 변경되었을 때. 서버 배포할 때.</li>
<li>컨슈머에 대한 토픽-파티션 할당은 동적 할당.</li>
</ul>
</li>
</ol>
<h4 id="3-2-프로듀싱-컨슈밍-실패시-전략">3-2. 프로듀싱, 컨슈밍 실패시 전략</h4>
<p>프로듀싱 실패시 전략</p>
<ul>
<li>브로커가 죽었고, 브로커가 새로 뜨기 전까지는 메세지가 유실될 수 있음.</li>
<li>실패전략 : 로컬 큐에 넣고 워커쓰레드가 다시 보내는, 우회전략을 만들어야 함.<br>
로컬큐가 불안하다면 remote queue를 만들어야 함. remote queue는 카프카가 아닌 SQS/SNS 등 다른 플랫폼으로 써야 한다.</li>
</ul>
<p>컨슈밍 실패시 전략</p>
<ul>
<li>카프카문제가 아닌 어플리케이션 문제이기 때문에 fallback topic을 따로 만들고,<br>
이 실패용 데이터에 대한 어플리케이션(fallback consumer)을 따로 만들어야한다.</li>
<li>스프링 클라우드에서 컨슈밍 실패전략을 잘 정리했으므로 해당 부분 참고할 것.</li>
</ul>
<hr>
<br>
<h3 id="4-카프카-스트림즈">4. 카프카 스트림즈</h3>
<p>토폴로지 생성</p>
<ul>
<li>토폴로지 : 위상수학에서 전체 그래프를 설명할 때. 각 프로세서 생성~!</li>
<li>서드(Serde)객체 : 역직렬화에 필요함.</li>
<li>간단한 구현 코드는 매닝 책에 있음. <a href="https://www.manning.com/downloads/1526"
    
        target="_blank"
    
>
    https://www.manning.com/downloads/1526
</a>
 (?)
KafkaStreamsYellingApp.java</li>
<li>application_id = group_id라고 생각하면 됨.</li>
</ul>
<p>스트림과 상태</p>
<ul>
<li>상태가 중요함. rds 접근하지 않고 빠른 처리속도를 원하면 메모리 즉 로컬데이터로 처리해야한다. 해당 데이터의 처리 상태가 어떻게 되었는지 관리가 필요함.</li>
<li>새로 데이터가 입소하면 상태정보를 파악해야 한다.
<ul>
<li>valueTransformer&hellip; 등을 쓸 수 있다.</li>
</ul>
</li>
<li>스트림처리에서는 추가된 문맥을 **상태(state)**라 함. = 데이터베이스 테이블 같은 이미지 (최신 데이터를 업데이트 한다~)
<ul>
<li><code>스트림처리</code> ? 개별 이벤트의 지속적인 흐름.</li>
</ul>
</li>
<li>카프카는 changelog (상태의 변경이 어떻게 이루어지고 있는지 로그)를 구성할 수 있음. 따라서 컨슈머가 줄거나 늘 때 데이터가 재배치 되는데 이 재배치되는 시간을 짧게 구성할 수 있음. <strong>status store를 재복구 가능함. 오류에 내구성이 강</strong>하다.</li>
</ul>
<p>스트림즈의 타임스탬프</p>
<ul>
<li>스트림 조인시 사용</li>
<li>변경로그(changelog) 업데이트 시 타임스탬프 기준으로 업데이트 &amp; 사용</li>
<li>저수준 API (<code>Processor.puntuator()</code> )언제 작동할지 결정</li>
</ul>
<p>KTable API</p>
<ul>
<li>스트림과 테이블 사이의 관계</li>
<li>집계, 카운트 위해 업데이트 작업 (구조적으로 체인지로그, status store 를 쿼리로 사용할 수 있음)</li>
<li>cf. 이벤트 vs. 업데이트 스트림?
<ul>
<li>이벤트스트림(kstream)</li>
<li>업데이트 스트림(k-table. 이 테이블은 status store와 연결됨)  비교</li>
</ul>
</li>
<li>집계와 윈도 작업(windowing).
<ul>
<li>스트리밍 데이터에서 집계, 정렬, 그룹화는 필수 도구.</li>
<li>윈도잉? 윈도 연산?
<ul>
<li>세션 윈도 (타임스탬프를 기준으로 나눈다)</li>
<li>텀블링 윈도 [20s간격으로] [20][20][20]</li>
<li>슬라이딩(호핑) 윈도 [20초 간격인데 5초 뒤에 다시 나눈다] → [20] 5 [20] 5 [20] &hellip;</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<br>
<h3 id="5-할당--uber-h3-사용">5. 할당- Uber H3 사용</h3>
<p>이번 세션에서는 배차 최적화 계산은 안하고, 어떻게 분산처리를 할 수 있을지에 대해 나눠볼 거임.<br>
우버에서 만든 공간을 분리하는 API : H3 User’s HHH..(헥소 지역 단위..)
<strong>경계지역은 주문과 배달원 미스매치가 일어남</strong>. 어쩔 수 없음.</p>
<p>다른 지역을 동시에 계산할 경우 배달원 중복이 발생함
제약사항이 있으므로, 헥사곤 7개를 15초 동안 한 바퀴 다 돌린다. (우회, 알고리즘으로..)
(이 부분은 우아한형제들 기술블로그에 자세히 나와있음. 봤던 기억이 남..!)</p>
<hr>
<br>
<h3 id="6-qa">6. Q&amp;A</h3>
<ul>
<li>메세지가 유실되어서 문제가 있는 경우는 있어도 유실되지 않았는데 문제되는 경우는 없었음. 물론 개발자가 개발하는 부분이라, hole이 있을 수 있고 이는 모니터링으로 채울 수 있음. 데이터 정합성이 100% 지켜질 순 없다..ㅠ</li>
<li>fallback 용 컨슈머는 따로 만들자~ 정답은 없으나..! 현 컨슈머가 판단하는 건 문제이니까.</li>
<li>Ktable windowing 을 잘 써서, 리밸런싱 시 빠르게 업데이트 할 수 있다. (위에 나온 ktable 부분, status store 참고)</li>
<li>카프카는 중복메세지 처리를 해줌. SNS에서는 보장이 안됨. ㅠ</li>
<li>모든 메세지 스키마를 동일하게 구성. 그래야지 모니터링이 수월하다. 파티셔닝하기도 쉽고~</li>
<li>해당 서비스(어플리케이션)의 역할은 프로듀싱까지 해야한다고 생각. 이벤트 리스너로 연결시켜서 처리함.</li>
<li>avro IDL ? → 찾아보겠다.</li>
<li>모니터링? Ktable → Streaming 에 붓고, → <strong>프로메테우스</strong>가 데이터를 갖고 있음. → <strong>그라파나</strong>가 해당 로그 polling</li>
</ul>
<br>
<br>
<br>
<p>추가로 읽어보면 좋을 내용 : 라인 <a href="https://engineering.linecorp.com/ko/blog/applying-kafka-streams-for-internal-message-delivery-pipeline/"
    
        target="_blank"
    
>
    내부 데이터 파이프라인에 Kafka Streams 적용하기
</a>
</p>

<br>
<br>
<br>
<br>
<br>
<script src="https://utteranc.es/client.js"
        repo="mand2/blog-comments"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>

<footer class="footline">
    
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/others/202204-woowahan-tech-seminar/" title="[세미나] 202204 우아한테크세미나-지속가능한 SW 개발을 위한 코드리뷰"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/others/activity-gdg-devfest-2020/" title="[활동] Devfest Korea 2020 10.16~" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1651153135"></script>
    <script src="/js/perfect-scrollbar.min.js?1651153135"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1651153135"></script>
    <script src="/js/jquery.sticky.js?1651153135"></script>
    <script src="/js/featherlight.min.js?1651153135"></script>
    <script src="/js/highlight.pack.js?1651153135"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1651153135"></script>
    <script src="/js/learn.js?1651153135"></script>
    <script src="/js/hugo-learn.js?1651153135"></script>

    <link href="/mermaid/mermaid.css?1651153135" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1651153135"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

